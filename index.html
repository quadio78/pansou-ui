<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000"/>
    <title>ç›˜æœ - åŸºäºTGé¢‘é“çš„ç½‘ç›˜æœç´¢å·¥å…·</title>
    <meta name="description" content="ç›˜æœæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç½‘ç›˜æœç´¢å·¥å…·ï¼Œèšåˆæ¥è‡ªTelegramé¢‘é“çš„æµ·é‡èµ„æºï¼Œæ”¯æŒ115ã€ç™¾åº¦äº‘ã€é˜¿é‡Œäº‘ç›˜ç­‰ä¸»æµç½‘ç›˜ã€‚å¿«é€Ÿã€ç²¾å‡†åœ°æ‰¾åˆ°æ‚¨éœ€è¦çš„ç”µå½±ã€éŸ³ä¹ã€æ¸¸æˆã€å­¦ä¹ èµ„æ–™ç­‰ã€‚">
    <meta name="keywords" content="ç½‘ç›˜æœç´¢, é˜¿é‡Œäº‘ç›˜, ç™¾åº¦ç½‘ç›˜, 115ç½‘ç›˜, è¿…é›·äº‘ç›˜, å¤¸å…‹ç½‘ç›˜, èµ„æºæœç´¢, ç›˜æœ, pansou, Telegram, TGé¢‘é“">
    <link rel="canonical" href="https://pansou.jkai.de/">
    <link rel="icon" href="/logo.png" type="image/png">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="msvalidate.01" content="9C398069E06C029D29F994105CDF858B" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cmp.gatekeeperconsent.com/min.js" data-cfasync="false"></script>
    <script src="https://the.gatekeeperconsent.com/cmp.min.js" data-cfasync="false"></script> 
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ios-bg': '#f5f7ff',
                        'ios-card': '#ffffff',
                        'ios-blue': '#0a84ff',
                        'ios-gray': '#8e8e93',
                        'ios-dark': '#1c1c1e'
                    },
                    boxShadow: {
                        'ios': '0 4px 20px rgba(0,0,0,0.08)',
                        'ios-card': '0 2px 10px rgba(0,0,0,0.05)'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.loli.net/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7ff 0%, #f0f4ff 100%);
            min-height: 100vh;
            color: #1c1c1e;
            transition: all 0.3s ease;
        }
        
        .ios-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.5);
            overflow: hidden;
        }
        
        .search-box {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .search-box.focused {
            box-shadow: 0 10px 30px rgba(10, 132, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .platform-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .result-item {
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .result-item:hover {
            background-color: rgba(10, 132, 255, 0.03);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-dots {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            background-color: #0a84ff;
            border-radius: 50%;
            margin: 0 3px;
            animation: bounce 1.5s infinite ease-in-out;
        }
        
        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        
        .platform-tag {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 20px;
            background: rgba(10, 132, 255, 0.1);
            color: #0a84ff;
        }
        
        .password-tag {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 20px;
            background: rgba(52, 199, 89, 0.15);
            color: #34c759;
            font-weight: 500;
            display: inline-block;
            line-height: 1.4;
            flex-shrink: 0; /* é˜²æ­¢åœ¨flexå¸ƒå±€ä¸­è¢«å‹ç¼© */
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
            border-radius: 8px;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        #backToTopBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(10, 132, 255, 0.8);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
        }

        #backToTopBtn:hover {
            background-color: rgba(10, 132, 255, 1);
            transform: scale(1.1);
        }

        #mobileAccessBtn {
            position: fixed;
            bottom: 80px; /* Positioned above the back-to-top button */
            right: 20px;
            background-color: rgba(44, 187, 99, 0.8); /* Green color */
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
        }

        #mobileAccessBtn:hover {
            background-color: rgba(44, 187, 99, 1);
            transform: scale(1.1);
        }

        #installPwaBtn {
            position: fixed;
            bottom: 80px; /* Adjusted to be on top of backToTopBtn on mobile */
            right: 20px;
            background-color: rgba(88, 86, 214, 0.8); /* Purple color */
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            font-size: 22px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
        }

        #installPwaBtn:hover {
            background-color: rgba(88, 86, 214, 1);
            transform: scale(1.1);
        }

        /* QR Code Modal Styles */
        .qr-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        .qr-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .qr-modal-overlay.visible .qr-modal-content {
            transform: scale(1);
            opacity: 1;
        }
        .qr-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: #8e8e93;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .qr-modal-close:hover {
            transform: scale(1.2);
        }
        #qrcode {
            margin: 1.5rem auto 0;
            width: 200px !important;
            height: 200px !important;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background-color: rgba(0,0,0,0.05);
            color: #1c1c1e;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            min-height: 44px; /* å¢åŠ è§¦æ‘¸åŒºåŸŸ */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-btn:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .filter-btn.active {
            background-color: #0a84ff;
            color: white;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(10, 132, 255, 0.2);
        }
        
        .category-tab {
            padding: 8px 16px;
            border-radius: 20px;
            background-color: rgba(0,0,0,0.05);
            color: #1c1c1e;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            min-height: 44px; /* å¢åŠ è§¦æ‘¸åŒºåŸŸ */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }

        .category-tab:hover {
            background-color: rgba(0,0,0,0.1);
        }

        .category-tab.active {
            background-color: #0a84ff;
            color: white;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(10, 132, 255, 0.2);
        }
        
        /* Tabå†…å®¹åŒºåŸŸæ ·å¼ */
        #categoryContentContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 0.75rem;
            padding: 1rem;
        }

        #categoryContentContainer .category-item-btn,
        #categoryContentContainer .hot-search-btn {
            transition: all 0.2s ease;
            font-weight: 500;
            text-align: center;
            justify-content: center;
            width: 100%; /* ç¡®ä¿æŒ‰é’®å¡«æ»¡ç½‘æ ¼å•å…ƒ */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block; /* ç¡®ä¿ ellipsis ç”Ÿæ•ˆ */
        }
        
        #categoryContentContainer .category-item-btn:hover,
        #categoryContentContainer .hot-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        /* ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding-top: 1.5rem; /* 32px -> 24px */
                padding-bottom: 1.5rem;
            }

            .text-center.mb-10 {
                margin-bottom: 2rem; /* 40px -> 32px */
            }

            #searchContainer {
                margin-bottom: 1.5rem; /* 32px -> 24px */
            }

            #categoryTabsContainer {
                margin-bottom: 1.5rem; /* 24px */
            }

            #categoryContentContainer {
                gap: 0.75rem; /* 8px -> 12px */
                padding: 0.75rem; /* 16px -> 12px */
            }

            .hot-search-btn, .category-item-btn {
                min-height: 40px;
                padding: 6px 14px;
                font-size: 0.9rem;
            }

            #resultsContainer .ios-card {
                border-radius: 16px;
            }

            .result-item {
                padding: 12px !important;
            }

            .result-item .text-lg {
                font-size: 1rem; /* 18px -> 16px */
                line-height: 1.4;
            }

            .result-item .text-xs {
                font-size: 0.7rem; /* 12px -> 11.2px */
            }
            
            .password-tag {
                padding: 4px 10px;
                font-weight: 600;
                border-radius: 12px;
                box-shadow: 0 2px 6px rgba(52, 199, 89, 0.2);
            }

            #searchButton, #resetButton {
                min-height: 44px;
                padding: 10px 20px !important; /* ä½¿ç”¨ !important ç¡®ä¿è¦†ç›–è¡Œå†…æ ·å¼ */
                flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
            }
            
            #backToTopBtn {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
            }
        }

        /* æ–°ç‰ˆæœç´¢æ¨¡å¼åˆ‡æ¢æ§ä»¶æ ·å¼ */
        .search-mode-btn.active {
            color: #0a84ff;
        }
        .search-mode-btn {
            color: #8e8e93;
        }
        .scroll-container {
            display: flex;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
        }
        .scroll-container::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        .scroll-item {
            flex: 0 0 auto;
            width: 80%; /* åœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºå¤§éƒ¨åˆ†å¡ç‰‡ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ */
            margin-right: 1rem;
        }
        @media (min-width: 768px) {
            .scroll-item {
                width: calc(33.333% - 1rem); /* åœ¨æ¡Œé¢ç«¯æ˜¾ç¤ºä¸‰åˆ— */
            }
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9067024774549867"
     crossorigin="anonymous"></script>
     <meta name="google-adsense-account" content="ca-pub-9067024774549867">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DQW3NHY60Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DQW3NHY60Z');
</script>
<body class="min-h-screen py-8 px-4 sm:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <a href="https://pansou.jkai.de/">
        <div class="text-center mb-10 fade-in">
            <div class="w-16 h-16 flex items-center justify-center mx-auto mb-4">
                <img src="/logo.png" alt="ç›˜æœ Logo" class="w-full h-full object-contain">
            </div>
            <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-ios-blue to-blue-500 bg-clip-text text-transparent">ç›˜æœ</h1>
            <p class="text-ios-gray text-lg">åŸºäºTGé¢‘é“çš„ç½‘ç›˜æœç´¢å·¥å…·</p>
            
            <!-- èµ„æºé›†åˆå…¥å£ -->
            <div class="mt-6 text-center">
                <a href="/collections-static/collections.html" class="inline-flex items-center bg-gradient-to-r from-ios-blue to-blue-500 text-white rounded-xl py-3 px-6 font-medium hover:opacity-90 transition-opacity shadow-lg">
                    <i class="fas fa-folder-open mr-2"></i>
                    ç²¾é€‰èµ„æºé›†åˆ
                    <i class="fas fa-chevron-right ml-2 text-sm"></i>
                </a>
                <p class="text-ios-gray text-sm mt-2">å‘ç°ç²¾å¿ƒæ•´ç†çš„ä¼˜è´¨èµ„æºåˆé›†</p>
            </div>
        </div>
        </a>

        <!-- æœç´¢æ¡† -->
        <div class="ios-card p-1 mb-8 search-box" id="searchContainer">
            <div class="flex items-center">
                <div class="pl-4 text-ios-gray">
                    <i class="fas fa-search"></i>
                </div>
                <input
                    type="text"
                    id="searchInput"
                    placeholder="æœç´¢ç½‘ç›˜èµ„æºï¼Œæ”¯æŒ115ã€ç™¾åº¦äº‘ã€é˜¿é‡Œäº‘ç›˜ç­‰"
                    class="w-full py-4 px-4 bg-transparent outline-none text-lg placeholder-ios-gray"
                    autocomplete="off"
                    inputmode="search"
                    enterkeyhint="search"
                >
                <button
                    id="resetButton"
                    class="bg-gradient-to-r from-gray-400 to-gray-500 text-white rounded-xl py-3 px-6 m-1 font-medium hover:opacity-90 transition-opacity hidden"
                    title="é‡ç½®æœç´¢"
                >
                    é‡ç½®
                </button>
                <button
                    id="searchButton"
                    class="bg-gradient-to-r from-ios-blue to-blue-500 text-white rounded-xl py-3 px-6 m-1 font-medium hover:opacity-90 transition-opacity"
                >
                    æœç´¢
                </button>
            </div>
        </div>

        <!-- ADS -->
        <!-- <script async="async" data-cfasync="false" src="//unhealthyirreparable.com/03202fae5f6b70e21d670c2cffec94c2/invoke.js"></script>
        <div id="container-03202fae5f6b70e21d670c2cffec94c2"></div> -->

        <!-- æœç´¢æ¨¡å¼åˆ‡æ¢ -->
        <!-- æœç´¢æ¨¡å¼åˆ‡æ¢ -->
        <div class="flex justify-center mb-6">
            <div id="searchModeContainer" class="relative grid grid-cols-2 items-center bg-gray-200/60 p-1 rounded-full w-64">
                <div id="searchModeSlider" class="absolute top-1 bottom-1 left-1 w-[calc(50%-4px)] bg-white rounded-full shadow-md transition-transform duration-300 ease-in-out" style="transform: translateX(calc(100% + 4px));"></div>
                <button id="modeFast" class="search-mode-btn z-10 py-2 text-center text-sm font-semibold transition-colors duration-300">å¿«é€Ÿæœç´¢</button>
                <button id="modeDeep" class="search-mode-btn active z-10 py-2 text-center text-sm font-semibold transition-colors duration-300">æ·±åº¦æœç´¢</button>
            </div>
        </div>

        <!-- éšæœºèµ„æºåˆé›†å±•ç¤º -->
        <div id="randomCollections" class="mt-8 mb-8"></div>
        
        <!-- åˆ†ç±»Tabåˆ‡æ¢ -->
        <div id="categoryTabsContainer" class="mb-6 px-2 ios-card">
            <!-- Tabå¯¼èˆª -->
            <div class="flex flex-wrap gap-2 p-4 border-b border-gray-100">
                <button class="category-tab active" data-category="hot">çƒ­æœ</button>
                <button class="category-tab" data-category="ç”µå½±">ç”µå½±</button>
                <button class="category-tab" data-category="ç”µè§†å‰§">ç”µè§†å‰§</button>
                <button class="category-tab" data-category="å°è¯´">å°è¯´</button>
                <button class="category-tab" data-category="ç»¼è‰º">ç»¼è‰º</button>
                <button class="category-tab" data-category="æ¸¸æˆ">æ¸¸æˆ</button>
                <button class="category-tab" data-category="åŠ¨æ¼«">åŠ¨æ¼«</button>
            </div>
            
            <!-- Tabå†…å®¹ -->
            <div id="categoryContentContainer" class="flex flex-wrap gap-2 items-center p-4">
                <!-- å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç­›é€‰å™¨ -->
        <div id="filterContainer" class="mb-6 px-2 hidden">
            <div class="flex flex-wrap gap-2">
                <!-- ç­›é€‰æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- ç»“æœç»Ÿè®¡ -->
        <div id="resultsHeader" class="mb-6 px-2 hidden">
            <div class="flex justify-between items-center flex-wrap gap-2">
                <h2 class="text-xl font-semibold">æœç´¢ç»“æœ</h2>
                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2">
                        <span class="text-sm text-ios-gray">æ’åº:</span>
                        <select id="sortSelect" class="text-sm bg-white border border-gray-200 rounded-lg px-3 py-1 text-ios-dark focus:outline-none focus:ring-2 focus:ring-ios-blue focus:border-transparent">
                            <option value="default">é»˜è®¤</option>
                            <option value="date-desc">æ—¶é—´ (æ–°åˆ°æ—§)</option>
                            <option value="date-asc">æ—¶é—´ (æ—§åˆ°æ–°)</option>
                            <option value="name-asc">åç§° (A-Z)</option>
                            <option value="name-desc">åç§° (Z-A)</option>
                        </select>
                    </div>
                    <span id="resultsCount" class="text-ios-gray"></span>
                </div>
            </div>
        </div>
        
        <!-- ç»“æœå®¹å™¨ -->
        <div id="resultsContainer" class="space-y-5"></div>
        
        <div class="mt-8 text-center text-ios-gray">
            <p class="text-sm">
                <a href="https://github.com/ZhjGo/pansou-ui" target="_blank" class="text-ios-blue hover:underline">æœ¬é¡¹ç›®åœ°å€</a>
                <span class="mx-2">|</span>
                <a href="https://github.com/fish2018/pansou" target="_blank" class="text-ios-blue hover:underline">æ•°æ®æ¥æº</a>
            </p>
            <button id="clearHotSearches" class="mt-2 text-xs text-red-500 hover:underline">æ¸…é™¤çƒ­æœè®°å½•</button>
            <button id="deleteSingleHotSearch" class="mt-2 ml-2 text-xs text-orange-500 hover:underline">åˆ é™¤æŒ‡å®šçƒ­æœ</button>
        </div>
    </div>

    <button id="backToTopBtn" title="è¿”å›é¡¶éƒ¨">
        <i class="fas fa-arrow-up"></i>
    </button>

    <button id="mobileAccessBtn" title="æ‰‹æœºè®¿é—®">
        <i class="fas fa-qrcode"></i>
    </button>

    <button id="installPwaBtn" title="å®‰è£…åº”ç”¨">
        <i class="fas fa-download"></i>
    </button>

    <!-- QR Code Modal -->
    <div id="qrModal" class="qr-modal-overlay">
        <div class="qr-modal-content">
            <i id="closeQrModal" class="fas fa-times qr-modal-close"></i>
            <h3 class="text-2xl font-bold text-ios-dark">åœ¨æ‰‹æœºä¸Šç»§ç»­è®¿é—®</h3>
            <p class="text-ios-gray mt-2">ä½¿ç”¨æ‰‹æœºæ‰«æäºŒç»´ç </p>
            <img id="qrCodeImg" src="/qrcode.png" alt="æ‰‹æœºè®¿é—®äºŒç»´ç " class="w-48 h-48 mx-auto mt-4 rounded-lg shadow-md">
        </div>
    </div>
    
    <script>
        // å¹³å°å›¾æ ‡å’Œåç§°æ˜ å°„
        const platformMap = {
            '115': { name: '115ç½‘ç›˜', icon: 'fa-box', color: 'bg-orange-500' },
            '123': { name: '123ç½‘ç›˜', icon: 'fa-hashtag', color: 'bg-green-500' },
            'mobile': { name: 'ç§»åŠ¨äº‘ç›˜', icon: 'fa-mobile-alt', color: 'bg-blue-500' },
            'xunlei': { name: 'è¿…é›·äº‘ç›˜', icon: 'fa-bolt', color: 'bg-yellow-500' },
            'aliyun': { name: 'é˜¿é‡Œäº‘ç›˜', icon: 'fa-cloud', color: 'bg-purple-500' },
            'uc': { name: 'UCç½‘ç›˜', icon: 'fa-compass', color: 'bg-red-500' },
            'tianyi': { name: 'å¤©ç¿¼äº‘ç›˜', icon: 'fa-cloud', color: 'bg-pink-500' },
            'quark': { name: 'å¤¸å…‹ç½‘ç›˜', icon: 'fa-search', color: 'bg-indigo-500' },
            'others': { name: 'å…¶ä»–ç½‘ç›˜', icon: 'fa-ellipsis-h', color: 'bg-gray-500' },
            'baidu': { name: 'ç™¾åº¦ç½‘ç›˜', icon: 'fa-database', color: 'bg-blue-600' }
        };
        
        // DOMå…ƒç´ 
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const resetButton = document.getElementById('resetButton');
        const searchContainer = document.getElementById('searchContainer');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsHeader = document.getElementById('resultsHeader');
        const resultsCount = document.getElementById('resultsCount');
        const filterContainer = document.getElementById('filterContainer');
        const sortSelect = document.getElementById('sortSelect');
        const randomCollectionsEl = document.getElementById('randomCollections');
        
        // æ–°ç‰ˆæœç´¢æ¨¡å¼æ§ä»¶å…ƒç´ 
        const modeFastBtn = document.getElementById('modeFast');
        const modeDeepBtn = document.getElementById('modeDeep');
        const modeSlider = document.getElementById('searchModeSlider');
        
        let currentSearchMode = 'deep'; // 'fast' or 'deep'

        let currentData = null; // ç¼“å­˜å½“å‰æœç´¢ç»“æœ
        let currentFilter = 'all'; // å½“å‰ç­›é€‰æ¡ä»¶
        let isInitialLoad = true; // è·Ÿè¸ªæ˜¯å¦ä¸ºåˆå§‹åŠ è½½çŠ¶æ€
        let searchTimeout = null; // æœç´¢é˜²æŠ–å®šæ—¶å™¨
        let isSearching = false; // æœç´¢çŠ¶æ€æ ‡è®°
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        searchInput.addEventListener('focus', () => {
            searchContainer.classList.add('focused');
        });
        
        searchInput.addEventListener('blur', () => {
            searchContainer.classList.remove('focused');
        });
        
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout);
                performSearch();
            }
        });
        
        
        searchButton.addEventListener('click', performSearch);
        
        // é‡ç½®æŒ‰é’®äº‹ä»¶
        const resetSearch = () => {
            searchInput.value = '';
            resultsContainer.innerHTML = '';
            resultsHeader.classList.add('hidden');
            filterContainer.classList.add('hidden');
            resetButton.classList.add('hidden');
            
            const categoryTabsContainer = document.getElementById('categoryTabsContainer');
            if (categoryTabsContainer) {
                categoryTabsContainer.classList.remove('hidden');
            }
            if (randomCollectionsEl) {
                randomCollectionsEl.style.display = 'block';
            }

            currentData = null;
            currentFilter = 'all';
            isInitialLoad = true;
            searchInput.focus();
        };
        
        resetButton.addEventListener('click', resetSearch);
        
        // ç›‘å¬è¾“å…¥æ¡†å˜åŒ–ï¼Œæ§åˆ¶é‡ç½®æŒ‰é’®æ˜¾ç¤º/éšè—
        searchInput.addEventListener('input', () => {
            if (searchInput.value.trim() !== '') {
                resetButton.classList.remove('hidden');
            } else {
                resetButton.classList.add('hidden');
            }
        });
        
        // æ’åºé€‰æ‹©äº‹ä»¶
        sortSelect.addEventListener('change', () => {
            if (currentData) {
                renderResults(currentData, currentFilter);
            }
        });
        
        // ç¤ºä¾‹æœç´¢ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.examples').forEach(el => {
            el.addEventListener('click', (e) => {
                searchInput.value = e.target.textContent;
                performSearch();
            });
        });

        // æ¸…é™¤çƒ­æœè®°å½•
        const clearButton = document.getElementById('clearHotSearches');
        clearButton.addEventListener('click', async () => {
            const password = prompt('è¯·è¾“å…¥æ¸…é™¤å¯†ç :');
            if (password === null) { // ç”¨æˆ·ç‚¹å‡»äº†å–æ¶ˆ
                return;
            }

            try {
                const response = await fetch('/api/clear-hot-searches', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password })
                });

                if (response.ok) {
                    alert('çƒ­æœè®°å½•å·²æ¸…é™¤ï¼');
                    // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¯çƒ­æœtabï¼Œå¦‚æœæ˜¯åˆ™åˆ·æ–°å†…å®¹
                    const activeTab = document.querySelector('.category-tab.active');
                    if (activeTab && activeTab.getAttribute('data-category') === 'hot') {
                        fetchAndRenderHotTabContent();
                    }
                } else {
                    const result = await response.json();
                    alert(`æ¸…é™¤å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                alert(`è¯·æ±‚å¤±è´¥: ${error.message}`);
            }
        });

        // åˆ é™¤æŒ‡å®šçƒ­æœ
        document.getElementById('deleteSingleHotSearch').addEventListener('click', async () => {
            const termToDelete = prompt('è¯·è¾“å…¥è¦åˆ é™¤çš„çƒ­æœè¯:');
            if (!termToDelete || termToDelete.trim() === '') {
                return;
            }

            const password = prompt('è¯·è¾“å…¥å¯†ç :');
            if (password === null) {
                return;
            }

            try {
                const response = await fetch('/api/delete-hot-search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: password, term: termToDelete.trim() })
                });

                if (response.ok) {
                    alert(`çƒ­æœè¯ "${termToDelete}" å·²åˆ é™¤ï¼`);
                    // æ£€æŸ¥å½“å‰æ˜¯å¦æ˜¯çƒ­æœtabï¼Œå¦‚æœæ˜¯åˆ™åˆ·æ–°å†…å®¹
                    const activeTab = document.querySelector('.category-tab.active');
                    if (activeTab && activeTab.getAttribute('data-category') === 'hot') {
                        fetchAndRenderHotTabContent();
                    }
                } else {
                    const result = await response.json();
                    alert(`åˆ é™¤å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}`);
                }
            } catch (error) {
                alert(`è¯·æ±‚å¤±è´¥: ${error.message}`);
            }
        });


        // è·å–å¹¶æ¸²æŸ“çƒ­æœtabå†…å®¹
        async function fetchAndRenderHotTabContent() {
            try {
                const response = await fetch('/api/hot-searches');
                if (!response.ok) return;

                const { hotSearches } = await response.json();
                const container = document.getElementById('categoryContentContainer');
                
                if (hotSearches && hotSearches.length > 0) {
                    let html = '';
                    hotSearches.forEach(item => {
                        html += `<button title="${item.term}" class="text-sm text-ios-blue bg-blue-50 px-3 py-1 rounded-full hover:bg-blue-100 transition-colors hot-search-btn">${item.term}</button>`;
                    });
                    container.innerHTML = html;

                    // ä¸ºçƒ­æœæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    container.querySelectorAll('.hot-search-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            searchInput.value = btn.textContent;
                            performSearch();
                        });
                    });
                } else {
                    container.innerHTML = '';
                }
            } catch (error) {
                console.error('Failed to fetch hot searches:', error);
            }
        }

        // æ¸²æŸ“åˆ†ç±»tabå†…å®¹
        function renderCategoryTabContent(category) {
            const container = document.getElementById('categoryContentContainer');
            // å®šä¹‰æ¯ä¸ªåˆ†ç±»çš„å›ºå®šæ•°æ®
            const categoryData = {
    'ç”µå½±': ['é˜¿å‡¡è¾¾3', 'è¶…äººä¼ æ‰¿', 'é›·ç¥5', 'èœ˜è››ä¾ 4', 'å¥‡å¼‚åšå£«3', 'å°šæ°”2', 'ç¢Ÿä¸­è°8', 'é€Ÿåº¦ä¸æ¿€æƒ…11', 'ä¾ç½—çºªä¸–ç•Œ4', 'çŒ©çƒå´›èµ·', 'ç–¯ç‹‚çš„éº¦å…‹æ–¯', 'ç–¾é€Ÿè¿½æ€5', 'æ²™ä¸˜3', 'ç¾å›½é˜Ÿé•¿4', 'é›·éœ†ç‰¹æ”»é˜Ÿ', 'ç¥å¥‡å››ä¾ ', 'åˆ€é”‹æˆ˜å£«', 'æµ·æ´‹å¥‡ç¼˜2', 'å†°é›ªå¥‡ç¼˜3', 'ç–¯ç‹‚åŠ¨ç‰©åŸ2', 'åŠŸå¤«ç†ŠçŒ«4', 'å°ç¥ç¬¬äºŒéƒ¨', 'ä¼ è¯´', 'å°„é›•è‹±é›„ä¼ ä¾ ä¹‹å¤§è€…'],
    'ç”µè§†å‰§': ['åº†ä½™å¹´2', 'èµ˜å©¿2', 'å”æœè¯¡äº‹å½•2', 'å¤§å¥‰æ‰“æ›´äºº', 'è—æµ·ä¼ ', 'å‡¡äººä¿®ä»™ä¼ ', 'èµ´å±±æµ·', 'æ°´é¾™åŸ', 'è‹±é›„è”ç›Ÿå‰§é›†', 'äººç”Ÿåˆ‡å‰²æœ¯2', 'æ˜ŸæœŸä¸‰2', 'æœ€åç”Ÿè¿˜è€…2', 'é±¿é±¼æ¸¸æˆ3', 'ç”œèœœå®¶å›­3', 'ä¸‰ä½“', 'è²èŠ±æ¥¼', 'ç¹èŠ±', 'ä¸å‡¤è¡Œ', 'å¢¨é›¨äº‘é—´', 'ç‹å¦–å°çº¢å¨˜', 'ç‹‚é£™', 'æ¼«é•¿çš„å­£èŠ‚', 'äººç”Ÿå¤æœ¬'],
    'å°è¯´': ['å¤§å¥‰æ‰“æ›´äºº', 'å®¿å‘½ä¹‹ç¯', 'èµ¤å¿ƒå·¡å¤©', 'çµå¢ƒè¡Œè€…', 'é“è¯¡å¼‚ä»™', 'æ·±æµ·ä½™çƒ¬', 'æ‹©æ—¥é£å‡', 'ä¸‡é“å‰‘å°Š', 'æ˜Ÿé—¨', 'é»œé¾™', 'æˆ‘æœ¬æ— æ„æˆä»™', 'å…‰é˜´ä¹‹å¤–', 'è¯¡ç§˜ä¹‹ä¸»', 'æ˜å…‹è¡—13å·', 'ç©å®¶å‡¶çŒ›', 'é•¿å¤œä½™ç«', 'ä»çº¢æœˆå¼€å§‹', 'é»æ˜ä¹‹å‰‘', 'é•‡å¦–åšç‰©é¦†', 'è¿™ä¸ªäººä»™å¤ªè¿‡æ­£ç»', 'å…¨çƒé«˜æ­¦', 'ä¸‡æ—ä¹‹åŠ«', 'ç¬¬ä¸€åºåˆ—'],
    'ç»¼è‰º': ['æ­Œæ‰‹2025', 'ä¹˜é£2025', 'æŠ«è†æ–©æ£˜', 'å£°ç”Ÿä¸æ¯', 'å¥”è·‘å§', 'æé™æŒ‘æˆ˜', 'ç‹ç‰Œå¯¹ç‹ç‰Œ', 'ä½ å¥½æ˜ŸæœŸå…­', 'å¯†å®¤å¤§é€ƒè„±', 'æ˜æ˜Ÿå¤§ä¾¦æ¢', 'äº”åå…¬é‡Œæ¡ƒèŠ±å', 'å‘å¾€çš„ç”Ÿæ´»', 'å¤©èµçš„å£°éŸ³', 'ä¹é˜Ÿçš„å¤å¤©', 'å¥‡è‘©è¯´', 'ä¸€å¹´ä¸€åº¦å–œå‰§å¤§èµ›', 'è¿™!å°±æ˜¯è¡—èˆ', 'ç§åœ°å§', 'å“ˆå“ˆå“ˆå“ˆå“ˆ', 'åŠç†Ÿæ‹äºº', 'å¿ƒåŠ¨çš„ä¿¡å·', 'æˆ‘ä»¬çš„æ­Œ'],
    'æ¸¸æˆ': ['é»‘ç¥è¯æ‚Ÿç©º', 'GTA6', 'æ€ªç‰©çŒäººè’é‡', 'æ°¸åŠ«æ— é—´', 'ä¸‰è§’æ´²è¡ŒåŠ¨', 'çº¢è‰²æ²™æ¼ ', 'æ­»äº¡ææµ…2', 'å¯‚é™å²­2', 'æœ€ç»ˆå¹»æƒ³7', 'ç‹å›½ä¹‹å¿ƒ4', 'åˆºå®¢ä¿¡æ¡å½±', 'æ˜Ÿåˆƒ', 'å¯¹é©¬å²›ä¹‹é­‚', 'è‰¾å°”ç™»æ³•ç¯', 'èµ›åšæœ‹å…‹2077', 'æˆ˜ç¥è¯¸ç¥é»„æ˜', 'å¡å°”è¾¾ä¼ è¯´ç‹å›½ä¹‹æ³ª', 'åšå¾·ä¹‹é—¨3', 'åŸç¥', 'å´©åæ˜Ÿç©¹é“é“', 'ç‹è€…è£è€€', 'å’Œå¹³ç²¾è‹±', 'è‹±é›„è”ç›Ÿ', 'æ— ç•å¥‘çº¦', 'ç‡•äº‘åå…­å£°'],
    'åŠ¨æ¼«': ['é¬¼ç­ä¹‹åˆƒ', 'å’’æœ¯å›æˆ˜3', 'æˆ‘ç‹¬è‡ªå‡çº§2', 'æ€ªå…½8å·', 'é“¾é”¯äºº', 'é¾™ç DAIMA', 'æµ·è´¼ç‹', 'æ­»ç¥åƒå¹´è¡€æˆ˜ç¯‡', 'é—´è°è¿‡å®¶å®¶3', 'è¿›å‡»çš„å·¨äºº', 'èˆªæµ·ç‹', 'åä¾¦æ¢æŸ¯å—', 'ä¸€äººä¹‹ä¸‹', 'é•–äºº', 'é›¾å±±äº”è¡Œ', 'å‡¡äººä¿®ä»™ä¼ ', 'æ–—ç ´è‹ç©¹', 'æ–—ç½—å¤§é™†', 'å®Œç¾ä¸–ç•Œ', 'åå™¬æ˜Ÿç©º', 'ä¸­å›½å¥‡è°­', 'è½¬ç”Ÿæˆä¸ºå²è±å§†è¿™æ¡£äº‹', 'æ— èŒè½¬ç”Ÿ', 'è¾‰å¤œå¤§å°å§æƒ³è®©æˆ‘å‘Šç™½']
};
            
            // è·å–å½“å‰åˆ†ç±»çš„æ•°æ®
            const data = categoryData[category] || [];
            
            // æ¸²æŸ“æ•°æ®ï¼Œä¸æ·»åŠ å‰ç¼€
            if (data.length > 0) {
                let html = '';
                data.forEach(item => {
                    html += `<button title="${item}" class="text-sm text-ios-blue bg-blue-50 px-3 py-1 rounded-full hover:bg-blue-100 transition-colors category-item-btn">${item}</button>`;
                });
                container.innerHTML = html;
                
                // ä¸ºåˆ†ç±»é¡¹æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                container.querySelectorAll('.category-item-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        searchInput.value = btn.textContent;
                        performSearch();
                    });
                });
            } else {
                container.innerHTML = '';
            }
        }

        // Tabåˆ‡æ¢å¤„ç†
        function handleTabSwitch() {
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰tabçš„activeç±»
                    document.querySelectorAll('.category-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // ä¸ºå½“å‰tabæ·»åŠ activeç±»
                    tab.classList.add('active');
                    
                    // è·å–åˆ†ç±»
                    const category = tab.getAttribute('data-category');
                    
                    // æ ¹æ®åˆ†ç±»æ¸²æŸ“å†…å®¹
                    if (category === 'hot') {
                        fetchAndRenderHotTabContent();
                    } else {
                        renderCategoryTabContent(category);
                    }
                });
            });
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–tabåˆ‡æ¢å’Œè·å–çƒ­æœ
        document.addEventListener('DOMContentLoaded', () => {
            handleTabSwitch();
            fetchAndRenderHotTabContent();
        });

        // --- æ–°ç‰ˆæœç´¢æ¨¡å¼åˆ‡æ¢é€»è¾‘ ---
        function setSearchMode(mode, isInitial = false) {
            if (!isInitial && currentSearchMode === mode) return;
            
            currentSearchMode = mode;
            
            if (mode === 'deep') {
                modeSlider.style.transform = 'translateX(100%)';
                modeDeepBtn.classList.add('active');
                modeFastBtn.classList.remove('active');
            } else {
                modeSlider.style.transform = 'translateX(0)';
                modeFastBtn.classList.add('active');
                modeDeepBtn.classList.remove('active');
            }
            
            if (!isInitial) {
                localStorage.setItem('searchMode', mode);
            }
        }

        modeFastBtn.addEventListener('click', () => setSearchMode('fast'));
        modeDeepBtn.addEventListener('click', () => setSearchMode('deep'));

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æœç´¢æ¨¡å¼
        document.addEventListener('DOMContentLoaded', () => {
            const savedMode = localStorage.getItem('searchMode') || 'deep'; // é»˜è®¤æ·±åº¦
            setSearchMode(savedMode, true);
        });

        // è¿”å›é¡¶éƒ¨æŒ‰é’®é€»è¾‘
        const backToTopBtn = document.getElementById('backToTopBtn');

        window.onscroll = function() {
            if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                backToTopBtn.style.display = "flex";
            } else {
                backToTopBtn.style.display = "none";
            }
        };

        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({top: 0, behavior: 'smooth'});
        });
        
        // æ‰§è¡Œæœç´¢
        async function performSearch() {
            const keyword = searchInput.value.trim();
            if (!keyword || isSearching) return;

            if (randomCollectionsEl) {
                randomCollectionsEl.style.display = 'none';
            }

            // æ ¹æ®æ–°çš„æ¨¡å¼å˜é‡ç¡®å®šæ’ä»¶
            const fastPlugins = 'pansearch,pan666';
            const allPlugins = 'pansearch,qupansou,panta,pan666,hunhepan,jikepan';
            const plugins = currentSearchMode === 'deep' ? allPlugins : fastPlugins;

            isInitialLoad = false;
            isSearching = true;
            
            // æ›´æ–°æœç´¢æŒ‰é’®çŠ¶æ€
            const originalText = searchButton.textContent;
            searchButton.disabled = true;
            searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>æœ';
            searchButton.classList.add('opacity-75');
            
            // éšè—é‡ç½®æŒ‰é’®
            resetButton.classList.add('hidden');

            // é¦–å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºè¿è§„è¯
            try {
                const checkResponse = await fetch('/api/check-term', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ term: keyword })
                });
                if (checkResponse.ok) {
                    const checkResult = await checkResponse.json();
                    if (checkResult.isForbidden) {
                        renderEmptyResults(); // ä½¿ç”¨é»˜è®¤çš„â€œæ— ç»“æœâ€æç¤º
                        return;
                    }
                }
            } catch (error) {
                console.error("Failed to check term:", error);
                // å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œå¯ä»¥é€‰æ‹©ç»§ç»­æœç´¢æˆ–æ˜¾ç¤ºé”™è¯¯ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç»§ç»­
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();
            
            fetch(`https://pansou.252035.xyz/api/search?kw=${encodeURIComponent(keyword)}&plugins=${plugins}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(async data => {
                    // é¦–å…ˆï¼Œæ£€æŸ¥APIè¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•æ•°æ®
                    if (data.code === 0 && (!data.data || data.data.total === 0)) {
                        renderEmptyResults();
                        return;
                    }

                    // å…¶æ¬¡ï¼Œæ£€æŸ¥APIæ˜¯å¦è¿”å›äº†é”™è¯¯
                    if (data.code !== 0 || !data.data.merged_by_type) {
                        renderResults(data); // ç›´æ¥æ¸²æŸ“é”™è¯¯çŠ¶æ€
                        return;
                    }

                    // --- æ•°æ®æ¸…æ´—å’Œè¿‡æ»¤ ---
                    const platformDomains = {
                        'aliyun': 'aliyundrive.com',
                        'quark': 'pan.quark.cn',
                        'baidu': 'pan.baidu.com',
                        '115': '115.com',
                        'xunlei': 'pan.xunlei.com',
                        'uc': 'drive.uc.cn',
                        'tianyi': 'cloud.189.cn',
                        '123': '123pan.com',
                        'mobile': 'caiyun.feixin.10086.cn'
                    };

                    let filteredMergedByType = {};
                    let filteredTotal = 0;

                    // è·å–å¤±æ•ˆçŠ¶æ€
                    const allResourceUrls = Object.values(data.data.merged_by_type).flat().map(r => r.url).filter(url => url);
                    let invalidStatus = {};
                    if (allResourceUrls.length > 0) {
                        const invalidStatusResponse = await fetch('/api/get-invalid-status', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ urls: allResourceUrls })
                        });
                        if (invalidStatusResponse.ok) {
                            const result = await invalidStatusResponse.json();
                            if(result.success) {
                                invalidStatus = result.invalidStatus;
                            }
                        }
                    }

                    for (const platform in data.data.merged_by_type) {
                        const items = data.data.merged_by_type[platform];
                        const validItems = items.filter(item => {
                            if (invalidStatus[item.url]) return false; // è¿‡æ»¤å¤±æ•ˆèµ„æº
                            if (!item.url || item.url.trim() === '') return false;
                            const expectedDomain = platformDomains[platform];
                            if (expectedDomain && !item.url.includes(expectedDomain)) return false;
                            return true;
                        });

                        if (validItems.length > 0) {
                            filteredMergedByType[platform] = validItems;
                            filteredTotal += validItems.length;
                        }
                    }
                    // --- è¿‡æ»¤ç»“æŸ ---

                    const filteredData = {
                        ...data,
                        data: {
                            ...data.data,
                            merged_by_type: filteredMergedByType,
                            total: filteredTotal
                        }
                    };
                    
                    currentData = filteredData; // æ›´æ–°ç¼“å­˜ä¸ºè¿‡æ»¤åçš„æ•°æ®

                    if (filteredTotal === 0) {
                        renderEmptyResults("æœªæ‰¾åˆ°æœ‰æ•ˆèµ„æºï¼Œå·²è¿‡æ»¤æ— æ•ˆæˆ–ä¸åŒ¹é…çš„é“¾æ¥ã€‚");
                    } else {
                        renderFilters(filteredData);
                        renderResults(filteredData);
                    }

                    if (filteredTotal > 0) {
                        renderFilters(filteredData);
                        renderResults(filteredData);
                        // åªæœ‰åœ¨æœ‰æœ‰æ•ˆç»“æœæ—¶æ‰è®°å½•æœç´¢è¯
                        recordSearchTerm(keyword);
                    } else {
                        renderEmptyResults("æœªæ‰¾åˆ°æœ‰æ•ˆèµ„æºï¼Œå·²è¿‡æ»¤æ— æ•ˆæˆ–ä¸åŒ¹é…çš„é“¾æ¥ã€‚");
                    }
                })
                .catch(error => {
                    console.error('Fetch Error:', error);
                    renderResults({
                        code: -1,
                        message: `è¯·æ±‚å¤±è´¥: ${error.message}`
                    });
                })
                .finally(() => {
                    // æ¢å¤æœç´¢æŒ‰é’®çŠ¶æ€
                    isSearching = false;
                    searchButton.disabled = false;
                    searchButton.textContent = originalText;
                    searchButton.classList.remove('opacity-75');
                    
                    // å¦‚æœæœç´¢æ¡†ä¸­æœ‰å†…å®¹ï¼Œæ˜¾ç¤ºé‡ç½®æŒ‰é’®
                    if (searchInput.value.trim() !== '') {
                        resetButton.classList.remove('hidden');
                    }
                });
        }
        
        // è®°å½•æœç´¢è¯
        function recordSearchTerm(term) {
            fetch('/api/hot-searches', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ term: term }),
            }).catch(error => console.error('Failed to record search term:', error));
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            resultsHeader.classList.add('hidden');
            // éšè—åˆ†ç±»tabåŒºåŸŸ
            const categoryTabsContainer = document.getElementById('categoryTabsContainer');
            if (categoryTabsContainer) {
                categoryTabsContainer.classList.add('hidden');
            }
            resultsContainer.innerHTML = `
                <div class="ios-card p-8 text-center fade-in">
                    <div class="loading-dots mb-4">
                        <div class="dot"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div>
                    <h3 class="text-xl font-medium mb-2">æ­£åœ¨æœç´¢èµ„æº</h3>
                    <p class="text-ios-gray">æ­£åœ¨å„å¤§ç½‘ç›˜æœç´¢ "${searchInput.value}"</p>
                </div>
            `;
            filterContainer.classList.add('hidden');
        }

        function renderEmptyResults(message = "æœªæ‰¾åˆ°ç›¸å…³èµ„æº") {
            resultsHeader.classList.remove('hidden');
            resultsCount.textContent = 'å…± 0 æ¡';
            
            // æä¾›æœç´¢å»ºè®®
            const suggestions = ['ç”µå½±', 'ç”µè§†å‰§', 'éŸ³ä¹', 'è½¯ä»¶', 'æ¸¸æˆ', 'æ•™ç¨‹', 'å°è¯´', 'æ¼«ç”»'];
            const randomSuggestions = suggestions.sort(() => 0.5 - Math.random()).slice(0, 4);
            
            resultsContainer.innerHTML = `
                <div class="ios-card p-8 text-center fade-in">
                    <i class="fas fa-search text-4xl text-ios-gray mb-4"></i>
                    <h3 class="text-xl font-medium mb-2">${message}</h3>
                    <p class="text-ios-gray mb-6">è¯·å°è¯•æ›´æ¢å…³é”®è¯æˆ–æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®</p>
                    <div class="mb-4">
                        <p class="text-sm text-ios-gray mb-3">è¯•è¯•è¿™äº›çƒ­é—¨æœç´¢ï¼š</p>
                        <div class="flex flex-wrap justify-center gap-2">
                            ${randomSuggestions.map(suggestion =>
                                `<button class="suggestion-btn text-sm text-ios-blue bg-blue-50 px-3 py-2 rounded-full hover:bg-blue-100 transition-colors">${suggestion}</button>`
                            ).join('')}
                        </div>
                    </div>
                    <div class="mb-4">
                        <a href="/collections-static/collections.html" class="inline-block bg-gradient-to-r from-ios-blue to-blue-500 text-white px-6 py-3 rounded-xl font-medium hover:opacity-90 transition-opacity">
                            <i class="fas fa-folder-open mr-2"></i>å»èµ„æºé›†åˆçœ‹çœ‹
                        </a>
                    </div>
                    <div class="text-xs text-ios-gray">
                        <p>ğŸ’¡ å°è´´å£«ï¼šä½¿ç”¨ Ctrl+K (Mac: Cmd+K) å¿«é€Ÿèšç„¦æœç´¢æ¡†</p>
                    </div>
                </div>
            `;
            
            // ä¸ºå»ºè®®æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            resultsContainer.querySelectorAll('.suggestion-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    searchInput.value = btn.textContent;
                    performSearch();
                });
            });
            
            filterContainer.classList.add('hidden');
            
            // éšè—åˆ†ç±»tabåŒºåŸŸ
            const categoryTabsContainer = document.getElementById('categoryTabsContainer');
            if (categoryTabsContainer) {
                categoryTabsContainer.classList.add('hidden');
            }
        }

        // æ¸²æŸ“ç­›é€‰å™¨
        function renderFilters(data) {
            if (data.code !== 0 || !data.data || !data.data.merged_by_type) {
                filterContainer.classList.add('hidden');
                return;
            }

            const mergedByType = data.data.merged_by_type;
            const platforms = Object.keys(mergedByType);

            if (platforms.length === 0) {
                filterContainer.classList.add('hidden');
                return;
            }

            let filterHTML = `<button class="filter-btn active" data-platform="all">å…¨éƒ¨</button>`;
            for (const platformType of platforms) {
                const platformInfo = platformMap[platformType] || { name: platformType };
                filterHTML += `<button class="filter-btn" data-platform="${platformType}">${platformInfo.name}</button>`;
            }

            filterContainer.querySelector('div').innerHTML = filterHTML;
            filterContainer.classList.remove('hidden');
        }
        
        // æ¸²æŸ“ç­›é€‰åçš„ç©ºç»“æœé¡µé¢
        function renderFilteredEmptyResults(message = "åœ¨å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°èµ„æº") {
            resultsContainer.innerHTML = `
                <div class="ios-card p-8 text-center fade-in">
                    <div class="text-5xl mb-4 text-ios-gray">
                        <i class="fas fa-filter"></i>
                    </div>
                    <h3 class="text-xl font-medium mb-2">ç­›é€‰æ— ç»“æœ</h3>
                    <p class="text-ios-gray mb-4">${message}</p>
                    <button class="clear-filter-btn text-ios-blue hover:underline" onclick="document.querySelector('.filter-btn[data-platform=all]').click()">
                        æ¸…é™¤ç­›é€‰æ¡ä»¶
                    </button>
                </div>
            `;
            resultsCount.textContent = `å…±æ‰¾åˆ° 0 ä¸ªèµ„æº`;
            resultsHeader.classList.remove('hidden');
            
            // éšè—åˆ†ç±»tabåŒºåŸŸ
            const categoryTabsContainer = document.getElementById('categoryTabsContainer');
            if (categoryTabsContainer) {
                categoryTabsContainer.classList.add('hidden');
            }
        }

        // æ¸²æŸ“æœç´¢ç»“æœ
        function renderResults(data, filter = 'all') {
            currentFilter = filter; // æ›´æ–°å½“å‰ç­›é€‰æ¡ä»¶
            if (data.code !== 0 || !data.data || !data.data.merged_by_type) {
                resultsContainer.innerHTML = `
                    <div class="ios-card p-8 text-center fade-in">
                        <div class="text-5xl mb-4 text-red-500">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="text-xl font-medium mb-2">æœç´¢é‡åˆ°é—®é¢˜</h3>
                        <p class="text-ios-gray mb-4">${data.message || 'ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•'}</p>
                        <div class="space-y-2">
                            <button class="retry-btn bg-ios-blue text-white px-4 py-2 rounded-lg hover:opacity-90 transition-opacity" onclick="performSearch()">
                                <i class="fas fa-redo mr-2"></i>é‡è¯•
                            </button>
                            <p class="text-xs text-ios-gray">æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡æ–°æœç´¢</p>
                        </div>
                    </div>
                `;
                resultsHeader.classList.add('hidden');
                filterContainer.classList.add('hidden');
                
                // éšè—åˆ†ç±»tabåŒºåŸŸ
                const categoryTabsContainer = document.getElementById('categoryTabsContainer');
                if (categoryTabsContainer) {
                    categoryTabsContainer.classList.add('hidden');
                }
                
                return;
            }

            const mergedByType = data.data.merged_by_type;
            let totalResults = 0;
            
            // æ„å»ºHTML
            let resultsHTML = '';
            
            const platformsToRender = filter === 'all' 
                ? Object.entries(mergedByType)
                : Object.entries(mergedByType).filter(([platformType]) => platformType === filter);

            if (platformsToRender.length === 0) {
                renderFilteredEmptyResults();
                return;
            }

            // æŒ‰å¹³å°ç±»å‹åˆ†ç»„æ¸²æŸ“
            for (const [platformType, resources] of platformsToRender) {
                const platformInfo = platformMap[platformType] || { 
                    name: platformType, 
                    icon: 'fa-cloud', 
                    color: 'bg-gray-500' 
                };
                
                // åº”ç”¨æ’åº
                const sortType = sortSelect.value;
                const sortedResources = sortResults(resources, sortType);
                
                totalResults += sortedResources.length;
                
                let platformHTML = `
                    <div class="ios-card overflow-hidden fade-in">
                        <div class="p-4 flex items-center border-b border-gray-100">
                            <div class="platform-icon ${platformInfo.color}">
                                <i class="fas ${platformInfo.icon}"></i>
                            </div>
                            <h3 class="font-semibold text-lg ml-3">${platformInfo.name}</h3>
                            <span class="ml-auto bg-gray-100 rounded-full px-3 py-1 text-sm mr-4">${sortedResources.length}ä¸ªèµ„æº</span>
                            ${sortedResources.length > 3 ? `
                                <button class="text-ios-blue text-sm font-medium toggle-btn" data-platform="${platformType}" data-expanded="false">
                                    <span class="expand-text">å±•å¼€</span>
                                    <span class="collapse-text hidden">æ”¶èµ·</span>
                                    <i class="fas fa-chevron-down ml-1 text-xs transition-transform"></i>
                                </button>
                            ` : ''}
                        </div>
                        <div class="divide-y divide-gray-100">
                `;
                
                const initialVisibleCount = 3;
                sortedResources.forEach((resource, index) => {
                    // æ ¼å¼åŒ–æ—¥æœŸ
                    let dateStr = '';
                    if (resource.datetime && resource.datetime !== '0001-01-01T00:00:00Z') {
                        const date = new Date(resource.datetime);
                        dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                    }
                    
                    const isHidden = index >= initialVisibleCount ? 'hidden' : '';

                    platformHTML += `
                        <a href="${resource.url}" target="_blank" rel="noreferrer" class="block result-item ${isHidden}" data-platform="${platformType}">
                            <div class="p-4">
                                <div class="flex justify-between">
                                    <div class="font-medium truncate pr-2">${resource.note}</div>
                                </div>
                                <div class="flex flex-col sm:flex-row sm:justify-between mt-2">
                                    <div class="text-sm text-ios-gray flex items-center mb-2 sm:mb-0">
                                        <i class="far fa-clock mr-1"></i>
                                        ${dateStr || 'æ—¶é—´æœªçŸ¥'}
                                    </div>
                                    <div class="flex items-center gap-3 flex-wrap justify-start">
                                        ${resource.password ? `<span class="password-tag">æå–ç : ${resource.password}</span>` : ''}
                                        <button class="copy-link-btn text-sm text-ios-gray hover:text-ios-blue transition-colors flex items-center" data-url="${resource.url}" title="å¤åˆ¶é“¾æ¥">
                                            <i class="fas fa-copy mr-1 text-xs"></i>
                                            å¤åˆ¶
                                        </button>
                                        <button class="mark-invalid-btn text-sm text-red-500 hover:text-red-700 transition-colors flex items-center" data-url="${resource.url}" title="æ ‡è®°ä¸ºå¤±æ•ˆé“¾æ¥">
                                            <i class="fas fa-times-circle mr-1 text-xs"></i>
                                            æ ‡è®°å¤±æ•ˆ
                                        </button>
                                        <div class="text-sm text-ios-blue flex items-center">
                                            ç«‹å³æŸ¥çœ‹ <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    `;
                });
                
                platformHTML += `</div>`;

                if (sortedResources.length > initialVisibleCount) {
                    platformHTML += `
                        <div class="p-3 text-center border-t border-gray-100 show-more-container">
                            <button class="text-ios-blue text-sm font-medium show-more-btn" data-platform="${platformType}">
                                æ˜¾ç¤ºæ›´å¤š (${sortedResources.length - initialVisibleCount}ä¸ª) <i class="fas fa-chevron-down ml-1 text-xs transition-transform"></i>
                            </button>
                        </div>
                    `;
                }

                platformHTML += `</div>`;
                resultsHTML += platformHTML;
            }
            
            // æ›´æ–°ç»“æœå®¹å™¨
            resultsContainer.innerHTML = resultsHTML;
            
            // æ›´æ–°ç»“æœç»Ÿè®¡
            let finalTotal = 0;
            if (filter === 'all') {
                finalTotal = Object.values(data.data.merged_by_type).reduce((sum, res) => sum + res.length, 0);
            } else {
                finalTotal = data.data.merged_by_type[filter]?.length || 0;
            }
            resultsCount.textContent = `å…±æ‰¾åˆ° ${finalTotal} ä¸ªèµ„æº`;
            resultsHeader.classList.remove('hidden');
            
            // éšè—åˆ†ç±»tabåŒºåŸŸ
            const categoryTabsContainer = document.getElementById('categoryTabsContainer');
            if (categoryTabsContainer) {
                categoryTabsContainer.classList.add('hidden');
            }
        }
        
        // äº‹ä»¶å§”æ‰˜å¤„ç†ç­›é€‰ã€æ˜¾ç¤ºæ›´å¤šã€å±•å¼€/æ”¶èµ·
        filterContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('filter-btn')) {
                const platform = e.target.dataset.platform;
                
                // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
                filterContainer.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');

                // é‡æ–°æ¸²æŸ“ç»“æœ
                renderResults(currentData, platform);
            }
        });

        resultsContainer.addEventListener('click', (e) => {
            const showMoreBtn = e.target.closest('.show-more-btn');
            const toggleBtn = e.target.closest('.toggle-btn');
            const copyBtn = e.target.closest('.copy-link-btn');
            const markInvalidBtn = e.target.closest('.mark-invalid-btn');

            if (copyBtn) {
                e.preventDefault();
                e.stopPropagation();
                copyToClipboard(copyBtn.dataset.url, copyBtn);
            } else if (markInvalidBtn) {
                e.preventDefault();
                e.stopPropagation();
                const resourceUrl = markInvalidBtn.dataset.url;
                markResourceAsInvalid(resourceUrl, markInvalidBtn);
            } else if (showMoreBtn) {
                handleToggle(showMoreBtn.dataset.platform, showMoreBtn);
                showMoreBtn.parentElement.classList.add('hidden'); // Hide "Show More" after click
            } else if (toggleBtn) {
                handleToggle(toggleBtn.dataset.platform, toggleBtn);
            }
        });

        function handleToggle(platform, button) {
            const isExpanded = button.dataset.expanded === 'true';
            const items = resultsContainer.querySelectorAll(`.result-item[data-platform="${platform}"]`);
            const initialVisibleCount = 3;

            items.forEach((item, index) => {
                if (index >= initialVisibleCount) {
                    item.classList.toggle('hidden', isExpanded);
                }
            });
            
            // Update all buttons for this platform
            const allToggleButtons = resultsContainer.querySelectorAll(`.toggle-btn[data-platform="${platform}"]`);
            allToggleButtons.forEach(btn => {
                btn.dataset.expanded = !isExpanded;
                btn.querySelector('.expand-text').classList.toggle('hidden', !isExpanded);
                btn.querySelector('.collapse-text').classList.toggle('hidden', isExpanded);
                btn.querySelector('i').classList.toggle('fa-chevron-down', isExpanded);
                btn.querySelector('i').classList.toggle('fa-chevron-up', !isExpanded);
            });

            // Hide the "show more" button container if it exists and we are expanding
            const showMoreContainer = resultsContainer.querySelector(`.show-more-btn[data-platform="${platform}"]`)?.parentElement;
            if (showMoreContainer && !isExpanded) {
                showMoreContainer.classList.add('hidden');
            }
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }

        // æ’åºå‡½æ•°
        function sortResults(resources, sortType) {
            if (!resources || resources.length === 0) return resources;
            
            const sorted = [...resources];
            
            switch (sortType) {
                case 'date-desc':
                    return sorted.sort((a, b) => {
                        const dateA = new Date(a.datetime || '1970-01-01');
                        const dateB = new Date(b.datetime || '1970-01-01');
                        return dateB - dateA;
                    });
                case 'date-asc':
                    return sorted.sort((a, b) => {
                        const dateA = new Date(a.datetime || '1970-01-01');
                        const dateB = new Date(b.datetime || '1970-01-01');
                        return dateA - dateB;
                    });
                case 'name-asc':
                    return sorted.sort((a, b) => (a.note || '').localeCompare(b.note || '', 'zh-CN'));
                case 'name-desc':
                    return sorted.sort((a, b) => (b.note || '').localeCompare(a.note || '', 'zh-CN'));
                default:
                    return resources; // ä¿æŒåŸå§‹é¡ºåº
            }
        }

        // æ ‡è®°èµ„æºä¸ºå¤±æ•ˆ
        async function markResourceAsInvalid(resourceUrl, button) {
            if (confirm('æ‚¨ç¡®å®šè¦å°†æ­¤èµ„æºæ ‡è®°ä¸ºå¤±æ•ˆå—ï¼Ÿ')) {
                try {
                    const response = await fetch('/api/mark-invalid', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ url: resourceUrl }),
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            // è§†è§‰ä¸Šç¦ç”¨æŒ‰é’®ï¼Œå¹¶æç¤ºç”¨æˆ·
                            button.disabled = true;
                            button.innerHTML = '<i class="fas fa-check-circle mr-1 text-xs"></i> å·²æ ‡è®°';
                            button.classList.remove('text-red-500', 'hover:text-red-700');
                            button.classList.add('text-gray-400', 'cursor-not-allowed');
                            
                            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¸€ä¸ªæ›´å‹å¥½çš„æç¤ºï¼Œæ¯”å¦‚ä¸€ä¸ªå°çš„toasté€šçŸ¥
                            console.log('èµ„æºå·²æˆåŠŸæ ‡è®°ä¸ºå¤±æ•ˆ');
                        } else {
                            throw new Error(result.message || 'æ ‡è®°å¤±è´¥');
                        }
                    } else {
                        throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                    }
                } catch (error) {
                    console.error('æ ‡è®°å¤±æ•ˆæ—¶å‡ºé”™:', error);
                    // å¯ä»¥åœ¨è¿™é‡Œå‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯æç¤º
                    alert('æ ‡è®°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                }
            }
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿åŠŸèƒ½
        async function copyToClipboard(url, button) {
            try {
                await navigator.clipboard.writeText(url);
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€æ˜¾ç¤ºæˆåŠŸ
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-1 text-xs"></i>å·²å¤åˆ¶';
                button.classList.remove('text-ios-gray', 'hover:text-ios-blue');
                button.classList.add('text-green-500');
                
                // 2ç§’åæ¢å¤åŸçŠ¶
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('text-green-500');
                    button.classList.add('text-ios-gray', 'hover:text-ios-blue');
                }, 2000);
                
            } catch (err) {
                // å¦‚æœç°ä»£APIå¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = url;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€æ˜¾ç¤ºæˆåŠŸ
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check mr-1 text-xs"></i>å·²å¤åˆ¶';
                    button.classList.remove('text-ios-gray', 'hover:text-ios-blue');
                    button.classList.add('text-green-500');
                    
                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.classList.remove('text-green-500');
                        button.classList.add('text-ios-gray', 'hover:text-ios-blue');
                    }, 2000);
                    
                } catch (fallbackErr) {
                    // å¦‚æœéƒ½å¤±è´¥äº†ï¼Œæ˜¾ç¤ºé”™è¯¯çŠ¶æ€
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-times mr-1 text-xs"></i>å¤åˆ¶å¤±è´¥';
                    button.classList.remove('text-ios-gray', 'hover:text-ios-blue');
                    button.classList.add('text-red-500');
                    
                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.classList.remove('text-red-500');
                        button.classList.add('text-ios-gray', 'hover:text-ios-blue');
                    }, 2000);
                }
            }
        }

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            // Ctrl+K æˆ– Cmd+K èšç„¦æœç´¢æ¡†
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                searchInput.focus();
                searchInput.select();
            }
            
            // ESC æ¸…ç©ºæœç´¢æ¡†
            if (e.key === 'Escape' && document.activeElement === searchInput) {
                searchInput.value = '';
                searchInput.blur();
            }
        });

        // é¡µé¢åŠ è½½æ—¶è·å–çƒ­æœ
        document.addEventListener('DOMContentLoaded', fetchAndRenderHotSearches);
    </script>
    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    
        // QR Code Modal Logic
        const qrModal = document.getElementById('qrModal');
        const mobileAccessBtn = document.getElementById('mobileAccessBtn');
        const closeQrBtn = document.getElementById('closeQrModal');

        mobileAccessBtn.addEventListener('click', () => {
            qrModal.style.display = 'flex';
            setTimeout(() => qrModal.classList.add('visible'), 10);
        });
    
        const closeModal = () => {
            qrModal.classList.remove('visible');
            setTimeout(() => qrModal.style.display = 'none', 300);
        };
    
        closeQrBtn.addEventListener('click', closeModal);
        qrModal.addEventListener('click', (e) => {
            if (e.target === qrModal) {
                closeModal();
            }
        });
    
        // PWA Installation Prompt Logic
        let deferredPrompt;
        const installButton = document.getElementById('installPwaBtn');
    
        window.addEventListener('beforeinstallprompt', (e) => {
            const isMobile = window.matchMedia("only screen and (max-width: 768px)").matches;
            if (isMobile) {
                e.preventDefault();
                deferredPrompt = e;
                if (installButton) {
                    installButton.style.display = 'flex';
                }
            }
        });
    
        if (installButton) {
            installButton.addEventListener('click', (e) => {
                if (deferredPrompt) {
                    installButton.style.display = 'none';
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the A2HS prompt');
                        } else {
                            console.log('User dismissed the A2HS prompt');
                        }
                        deferredPrompt = null;
                    });
                }
            });
        }
        
        window.addEventListener('appinstalled', (evt) => {
          console.log('PWA was installed.');
          if (installButton) {
            installButton.style.display = 'none';
          }
        });
    
        // Show mobile access button only on desktop
        document.addEventListener('DOMContentLoaded', () => {
            const isMobile = window.matchMedia("only screen and (max-width: 768px)").matches;
            if (!isMobile) {
                mobileAccessBtn.style.display = 'flex';
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (!randomCollectionsEl) return;

            fetch('/collections-static/collections.json')
                .then(response => response.json())
                .then(data => {
                    const collections = data.collections;
                    if (collections && collections.length > 0) {
                        const randomThree = collections.sort(() => 0.5 - Math.random()).slice(0, 3);
                        
                        let html = '<h2 class="text-2xl font-bold text-center mb-6">çŒœä½ å–œæ¬¢</h2>';
                        html += '<div class="scroll-container pb-4">';

                        randomThree.forEach(collection => {
                            const isExternalUrl = collection.cover && (collection.cover.startsWith('http://') || collection.cover.startsWith('https://'));
                            const coverImage = collection.cover ?
                                (isExternalUrl ? collection.cover : `/collections-static/images/${collection.cover.split('/').pop()}`) :
                                '';

                            html += `
                                <a href="/collections-static/${collection.id}.html" class="ios-card p-4 block hover:shadow-ios-card transition-shadow scroll-item">
                                    <div class="h-40 bg-gray-200 rounded-lg mb-4 overflow-hidden">
                                        ${coverImage ? `<img src="${coverImage}" alt="${collection.title}" class="w-full h-full object-cover">` : ''}
                                    </div>
                                    <h3 class="font-semibold text-lg mb-1 truncate">${collection.title}</h3>
                                    <p class="text-ios-gray text-sm truncate">${collection.description}</p>
                                </a>
                            `;
                        });

                        html += '</div>';
                        randomCollectionsEl.innerHTML = html;
                    }
                })
                .catch(error => console.error('Error fetching random collections:', error));
        });
    </script>
    </body>
</html>